<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Album - Weitai Kang</title>
  <meta name="author" content="Weitai Kang">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="stylesheet.css">
  <style>
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      max-width: 80%;
      max-height: 80%;
    }
    .caption {
      color: white;
      text-align: center;
      margin-top: 10px;
    }
    .close {
      color: white;
      position: absolute;
      top: 10px;
      right: 25px;
      font-size: 35px;
      cursor: pointer;
    }
    .section-header {
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    .arrow {
      margin-left: 10px;
      font-size: 16px;
      transition: transform 0.3s;
    }
    .arrow.down {
      transform: rotate(0deg);
    }
    .arrow.up {
      transform: rotate(180deg);
    }
    .section-content {
      display: none;
    }
    /* Styling for the large image */
    .large-image {
      width: 100%;
      max-width: 800px;
      height: auto;
      margin: 20px auto;
      display: block;
    }
    /* Responsive design for mobile */
    @media (max-width: 600px) {
      .large-image {
        max-width: 100%;
        margin: 10px auto;
      }
      p {
        font-size: 16px;
      }
    }
    /* Style for the footer link */
    .footer {
      text-align: center;
      padding: 20px 0;
      position: relative;
      bottom: 0;
      width: 100%;
      margin-top: 20px;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .content {
      flex: 1 0 auto;
    }
    .gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      padding: 20px;
      justify-content: center;
    }
    .gallery img {
      width: 185px;
      height: 185px;
      object-fit: cover;
      cursor: pointer;
      border: 1px solid #ddd;
      transition: transform 0.3s ease, opacity 0.3s ease;
      opacity: 0.5; /* Subtle effect for unloaded images */
    }
    .gallery img.loaded {
      opacity: 1; /* Full opacity when loaded */
    }
    .modal {
      transition: opacity 0.3s ease;
    }
    .modal-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 90%;
      max-height: 80%;
    }
    #modalImage {
      width: 100%;
      max-width: 1200px;
      height: auto;
      max-height: 60vh;
      object-fit: contain;
    }
    .caption {
      color: white;
      text-align: center;
      margin-top: 20px;
      font-size: 20px;
    }
    .photo-counter {
      color: white;
      text-align: center;
      margin-top: 10px;
      font-size: 16px;
    }
    .nav-arrow {
      color: white;
      font-size: 40px;
      cursor: pointer;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      user-select: none;
      padding: 10px;
    }
    .nav-arrow.left {
      left: 10px;
    }
    .nav-arrow.right {
      right: 10px;
    }
    .nav-arrow:hover {
      color: #ccc;
    }
    @media (max-width: 768px) {
      .gallery img {
        width: 150px;
        height: 150px;
      }
      .gallery {
        gap: 10px;
        padding: 10px;
      }
      #modalImage {
        max-height: 50vh;
      }
      .caption {
        margin-top: 15px;
        font-size: 16px;
      }
      .photo-counter {
        font-size: 14px;
      }
      .close {
        font-size: 30px;
        right: 15px;
        top: 15px;
      }
      .nav-arrow {
        font-size: 30px;
        padding: 15px;
      }
      .nav-arrow.left {
        left: 5px;
      }
      .nav-arrow.right {
        right: 5px;
      }
    }
    @media (max-width: 480px) {
      .gallery img {
        width: 120px;
        height: 120px;
      }
      .caption {
        font-size: 14px;
      }
      .photo-counter {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="content"></div>
  <table style="width:100%;max-width:900px;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;">
    <tbody>
      <tr style="padding:0px">
        <td style="padding:0px">
          <table style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;">
            <tbody>
              <tr style="padding:0px">
                <td style="padding:2.5%;width:100%;vertical-align:middle">
                  <img src="experiences/Friends.png" alt="Large Image" class="large-image">
                  <p style="text-align:center">
                    <name>Hi, my <em>FRIENDS</em>!üëã</name>
                  </p>
                </td>
              </tr>
            </tbody>
          </table>

        </td>
      </tr>
    </tbody>
  </table>

  <!-- Footer -->
  <div class="footer">
    <p style="text-align:center">
      <a href="index.html">Back to Homepage</a>
    </p>
  </div>

  <!-- Modal for Enlarged Image -->
  <div id="myModal" class="modal">
    <span class="close" onclick="closeModal()">√ó</span>
    <span class="nav-arrow left" onclick="showImage(currentSection, currentImageIndex - 1)">‚ùÆ</span>
    <div class="modal-content">
      <img id="modalImage">
      <div class="caption" id="captionText"></div>
      <div class="photo-counter" id="photoCounter"></div>
    </div>
    <span class="nav-arrow right" onclick="showImage(currentSection, currentImageIndex + 1)">‚ùØ</span>
  </div>

  <script>
    // Store the current section and image index for navigation
    let currentSection = '';
    let currentImageIndex = 0;
    let imageData = {
      travels: [],
      shows: [],
      sports: []
    };

    // Initialize image data and lazy loading
    document.addEventListener('DOMContentLoaded', function() {
      // Lazy loading with Intersection Observer
      const images = document.querySelectorAll('.gallery img[data-src]');
      const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.classList.add('loaded');
            img.removeAttribute('data-src');
            observer.unobserve(img);
          }
        });
      }, { rootMargin: '0px 0px 100px 0px' }); // Load 100px before entering viewport

      images.forEach(img => observer.observe(img));

      // Initialize image data for modal navigation
      ['travels', 'shows', 'sports'].forEach(section => {
        const gallery = document.querySelector(`#${section}-content .gallery`);
        if (gallery) {
          const images = gallery.querySelectorAll('img');
          images.forEach((img, index) => {
            const onclickAttr = img.getAttribute('onclick');
            const captionMatch = onclickAttr.match(/openModal\('[^']+', '([^']+)'\)/);
            const caption = captionMatch ? captionMatch[1] : '';
            
            imageData[section].push({
              src: img.dataset.src || img.src, // Use data-src if available, else src
              caption: caption
            });
            img.addEventListener('click', () => {
              currentSection = section;
              currentImageIndex = index;
              openModal(img.dataset.src || img.src, caption);
            });
          });

          // Add swipe support to the modal
          let touchStartX = 0;
          let touchEndX = 0;
          const modalImage = document.getElementById("modalImage");

          modalImage.addEventListener('touchstart', function(event) {
            touchStartX = event.changedTouches[0].screenX;
          });

          modalImage.addEventListener('touchend', function(event) {
            touchEndX = event.changedTouches[0].screenX;
            handleSwipe();
          });

          function handleSwipe() {
            const swipeThreshold = 50;
            if (touchEndX < touchStartX - swipeThreshold) {
              showImage(currentSection, currentImageIndex + 1);
            }
            if (touchEndX > touchStartX + swipeThreshold) {
              showImage(currentSection, currentImageIndex - 1);
            }
          }
        }
      });
    });

    function openModal(src, caption) {
      const modal = document.getElementById("myModal");
      modal.style.display = "flex";
      modal.style.opacity = "0";
      setTimeout(() => { modal.style.opacity = "1"; }, 10);
      document.getElementById("modalImage").src = src;
      document.getElementById("captionText").innerText = caption;
      document.getElementById("photoCounter").innerText = `Photo ${currentImageIndex + 1} of ${imageData[currentSection].length}`;
    }

    function closeModal() {
      const modal = document.getElementById("myModal");
      modal.style.opacity = "0";
      setTimeout(() => { modal.style.display = "none"; }, 300);
    }

    function showImage(section, index) {
      if (index < 0) index = imageData[section].length - 1;
      if (index >= imageData[section].length) index = 0;
      currentImageIndex = index;
      const image = imageData[section][index];
      openModal(image.src, image.caption);
    }

    window.onclick = function(event) {
      if (event.target == document.getElementById("myModal")) {
        closeModal();
      }
    }

    document.addEventListener('keydown', function(event) {
      if (document.getElementById("myModal").style.display === "flex") {
        if (event.key === "Escape" || event.key === " ") {
          event.preventDefault();
          closeModal();
        } else if (event.key === "ArrowLeft") {
          showImage(currentSection, currentImageIndex - 1);
        } else if (event.key === "ArrowRight") {
          showImage(currentSection, currentImageIndex + 1);
        }
      }
    });

    function toggleSection(section) {
      const content = document.getElementById(section + '-content');
      const arrow = document.getElementById(section + '-arrow');
      if (content.style.display === "block") {
        content.style.opacity = "0";
        setTimeout(() => {
          content.style.display = "none";
          arrow.classList.remove("up");
          arrow.classList.add("down");
        }, 300);
      } else {
        content.style.display = "block";
        setTimeout(() => { content.style.opacity = "1"; }, 10);
        arrow.classList.remove("down");
        arrow.classList.add("up");
      }
    }
  </script>
</body>
</html>